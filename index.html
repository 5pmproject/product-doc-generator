<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제품 문서 생성 시스템</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, #f5f1ed 0%, #e8e1d9 100%);
            min-height: 100vh;
            padding: 20px;
            color: #4a4237;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: #6b5d52;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            color: #8b7d6b;
            font-size: 1rem;
            font-weight: 300;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .workflow-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        .workflow-step {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background: #f5f1ed;
            font-size: 0.85rem;
            color: #8b7d6b;
            transition: all 0.3s ease;
        }

        .workflow-step.active {
            background: #c9b5a0;
            color: #fff;
            font-weight: 600;
        }

        .workflow-step.completed {
            background: #6b9b6b;
            color: #fff;
        }

        .workflow-arrow {
            color: #c9b5a0;
            font-size: 1.2rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e8e1d9;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #c9b5a0 0%, #a89075 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #8b7d6b;
        }

        .form-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(107, 93, 82, 0.1);
            display: none;
        }

        .form-card.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-number {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: #c9b5a0;
            opacity: 0.3;
            margin-bottom: 10px;
        }

        .question-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: #6b5d52;
            margin-bottom: 10px;
        }

        .question-desc {
            color: #8b7d6b;
            font-size: 0.95rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .input-group {
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #e8e1d9;
            border-radius: 12px;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
            color: #4a4237;
            background: #fefdfb;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #c9b5a0;
        }

        textarea.error {
            border-color: #d4a08a;
        }

        .char-counter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 0.85rem;
            color: #8b7d6b;
        }

        .char-count {
            font-weight: 600;
        }

        .char-count.warning {
            color: #d4a08a;
        }

        .example-text {
            background: #f5f1ed;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #8b7d6b;
            margin-top: 12px;
            border-left: 3px solid #c9b5a0;
        }

        .example-label {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #c9b5a0 0%, #a89075 100%);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(168, 144, 117, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #e8e1d9;
            color: #6b5d52;
        }

        .btn-secondary:hover {
            background: #d9d0c5;
        }

        .auto-save-indicator {
            text-align: center;
            color: #8b7d6b;
            font-size: 0.85rem;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        .completion-screen {
            display: none;
            text-align: center;
            padding: 60px 40px;
        }

        .completion-screen.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .completion-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .completion-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: #6b5d52;
            margin-bottom: 15px;
        }

        .completion-desc {
            color: #8b7d6b;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* BRD 생성 화면 */
        .document-screen {
            display: none;
            padding: 40px;
        }

        .document-screen.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8e1d9;
        }

        .document-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: #6b5d52;
        }

        .document-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-generating {
            background: #fff5e6;
            color: #d4a08a;
        }

        .badge-generated {
            background: #e8f5e8;
            color: #6b9b6b;
        }

        .badge-approved {
            background: #c9b5a0;
            color: #fff;
        }

        .generating-animation {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e8e1d9;
            border-top-color: #c9b5a0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .generating-text {
            font-size: 1.2rem;
            color: #6b5d52;
            margin-bottom: 10px;
        }

        .generating-subtext {
            color: #8b7d6b;
            font-size: 0.9rem;
        }

        .document-content {
            background: #fefdfb;
            border: 2px solid #e8e1d9;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            min-height: 400px;
            line-height: 1.8;
            font-size: 1rem;
            color: #4a4237;
        }

        .document-content h2 {
            font-family: 'Playfair Display', serif;
            color: #6b5d52;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .document-content h2:first-child {
            margin-top: 0;
        }

        .document-content h3 {
            font-family: 'Playfair Display', serif;
            color: #8b7d6b;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .document-content p {
            margin-bottom: 15px;
        }

        .document-content ul, .document-content ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .document-content li {
            margin-bottom: 8px;
        }

        .document-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-success {
            background: linear-gradient(135deg, #6b9b6b 0%, #5a8a5a 100%);
            color: #fff;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 155, 107, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #c9b5a0;
            color: #6b5d52;
        }

        .btn-outline:hover {
            background: #c9b5a0;
            color: #fff;
        }

        .error-message {
            background: #ffe5e5;
            border: 2px solid #d4a08a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: #8b4a4a;
        }

        .error-message h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .form-card {
                padding: 24px;
            }

            .question-title {
                font-size: 1.5rem;
            }

            .button-group {
                flex-direction: column;
            }

            .document-screen {
                padding: 24px;
            }

            .document-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .document-content {
                padding: 24px;
            }

            .document-actions {
                flex-direction: column;
            }

            .document-actions button {
                width: 100%;
            }

            .workflow-status {
                flex-wrap: wrap;
            }

            .workflow-step {
                font-size: 0.75rem;
                padding: 8px 4px;
            }

            .workflow-arrow {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>제품 문서 생성 시스템</h1>
            <p class="subtitle">5분만 투자하면 전문적인 BRD, PRD, TRD를 자동 생성합니다</p>
        </header>

        <div class="progress-container">
            <div class="workflow-status" id="workflowStatus">
                <div class="workflow-step" data-step="input">입력</div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step" data-step="brd">BRD</div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step" data-step="prd">PRD</div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step" data-step="trd">TRD</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="progressText">질문 1 / 6</span>
                <span id="progressPercent">0% 완료</span>
            </div>
        </div>

        <!-- Question 1 -->
        <div class="form-card active" data-step="1">
            <div class="question-number">01</div>
            <h2 class="question-title">핵심 인사이트</h2>
            <p class="question-desc">당신이 발견한 가장 중요한 통찰은 무엇인가요? 이 제품이 해결하려는 핵심 문제를 설명해주세요.</p>
            
            <div class="input-group">
                <textarea id="insight" maxlength="200" placeholder="예: 현재 시장에서 사용자들은..."></textarea>
                <div class="char-counter">
                    <span class="char-count" id="insightCount">0 / 200자</span>
                    <span id="insightStatus"></span>
                </div>
                <div class="example-text">
                    <div class="example-label">💡 예시</div>
                    소비자의 80%가 제품 리뷰를 읽지만, 70%가 리뷰의 신뢰성을 의심합니다. 검증된 구매자의 실제 경험을 효과적으로 전달하는 방법이 필요합니다.
                </div>
            </div>
        </div>

        <!-- Question 2 -->
        <div class="form-card" data-step="2">
            <div class="question-number">02</div>
            <h2 class="question-title">검증 근거</h2>
            <p class="question-desc">이 인사이트를 뒷받침하는 데이터나 근거가 있나요? 시장 조사, 사용자 인터뷰, 데이터 분석 결과 등을 공유해주세요.</p>
            
            <div class="input-group">
                <textarea id="validation" maxlength="150" placeholder="예: 500명 사용자 인터뷰 결과..."></textarea>
                <div class="char-counter">
                    <span class="char-count" id="validationCount">0 / 150자</span>
                    <span id="validationStatus"></span>
                </div>
                <div class="example-text">
                    <div class="example-label">💡 예시</div>
                    3개월간 500명 대상 설문 결과, 가짜 리뷰 때문에 구매를 포기한 경험이 평균 3.2회. A/B 테스트 결과 검증된 리뷰는 전환율 45% 향상.
                </div>
            </div>
        </div>

        <!-- Question 3 -->
        <div class="form-card" data-step="3">
            <div class="question-number">03</div>
            <h2 class="question-title">팀 역량</h2>
            <p class="question-desc">이 프로젝트를 성공시킬 수 있는 팀의 강점은 무엇인가요? 보유한 기술, 경험, 자원을 설명해주세요.</p>
            
            <div class="input-group">
                <textarea id="capability" maxlength="150" placeholder="예: 우리 팀은..."></textarea>
                <div class="char-counter">
                    <span class="char-count" id="capabilityCount">0 / 150자</span>
                    <span id="capabilityStatus"></span>
                </div>
                <div class="example-text">
                    <div class="example-label">💡 예시</div>
                    AI/ML 전문가 3명, 전자상거래 플랫폼 개발 경험 5년, 자연어 처리 모델 구축 경험. 이전 프로젝트에서 10만 사용자 규모 서비스 운영.
                </div>
            </div>
        </div>

        <!-- Question 4 -->
        <div class="form-card" data-step="4">
            <div class="question-number">04</div>
            <h2 class="question-title">절대 원칙</h2>
            <p class="question-desc">이 제품 개발에서 절대 타협할 수 없는 원칙이나 가치는 무엇인가요?</p>
            
            <div class="input-group">
                <textarea id="principle" maxlength="100" placeholder="예: 사용자 프라이버시는..."></textarea>
                <div class="char-counter">
                    <span class="char-count" id="principleCount">0 / 100자</span>
                    <span id="principleStatus"></span>
                </div>
                <div class="example-text">
                    <div class="example-label">💡 예시</div>
                    투명성과 정직함. 모든 리뷰는 실제 구매자만 작성 가능하며, 조작이나 가짜 리뷰는 절대 허용하지 않습니다.
                </div>
            </div>
        </div>

        <!-- Question 5 -->
        <div class="form-card" data-step="5">
            <div class="question-number">05</div>
            <h2 class="question-title">성공 정의</h2>
            <p class="question-desc">이 제품이 성공했다고 판단할 수 있는 기준은 무엇인가요? 구체적인 지표나 목표를 제시해주세요.</p>
            
            <div class="input-group">
                <textarea id="success" maxlength="100" placeholder="예: 6개월 내..."></textarea>
                <div class="char-counter">
                    <span class="char-count" id="successCount">0 / 100자</span>
                    <span id="successStatus"></span>
                </div>
                <div class="example-text">
                    <div class="example-label">💡 예시</div>
                    6개월 내 월간 활성 사용자 5만명, 리뷰 신뢰도 평가 4.5/5 이상, 구매 전환율 기존 대비 30% 향상.
                </div>
            </div>
        </div>

        <!-- Question 6 -->
        <div class="form-card" data-step="6">
            <div class="question-number">06</div>
            <h2 class="question-title">핵심 기능 아이디어</h2>
            <p class="question-desc">이 문제를 해결하기 위한 핵심 기능이나 솔루션 아이디어를 간단히 설명해주세요.</p>
            
            <div class="input-group">
                <textarea id="feature" maxlength="150" placeholder="예: AI 기반..."></textarea>
                <div class="char-counter">
                    <span class="char-count" id="featureCount">0 / 150자</span>
                    <span id="featureStatus"></span>
                </div>
                <div class="example-text">
                    <div class="example-label">💡 예시</div>
                    AI 기반 리뷰 검증 시스템: 구매 이력 확인, 텍스트 분석으로 가짜 리뷰 탐지, 검증 배지 부여. 사용자는 신뢰도 점수를 실시간 확인 가능.
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div class="form-card completion-screen" id="completionScreen">
            <div class="completion-icon">✨</div>
            <h2 class="completion-title">입력 완료!</h2>
            <p class="completion-desc">
                모든 정보가 성공적으로 저장되었습니다.<br>
                이제 전문적인 BRD 문서를 생성할 준비가 되었습니다.
            </p>
            <button class="btn-primary" onclick="startBRDGeneration()">BRD 생성하기</button>
        </div>

        <!-- BRD 생성 화면 -->
        <div class="form-card document-screen" id="brdScreen">
            <div class="document-header">
                <h2 class="document-title">Business Requirements Document</h2>
                <span class="document-badge badge-generating" id="brdBadge">생성 중</span>
            </div>

            <!-- 생성 중 애니메이션 -->
            <div class="generating-animation" id="brdGenerating">
                <div class="spinner"></div>
                <div class="generating-text">BRD를 생성하고 있습니다...</div>
                <div class="generating-subtext">Claude AI가 프로젝트 데이터를 분석 중입니다</div>
            </div>

            <!-- 에러 메시지 -->
            <div class="error-message" id="brdError" style="display: none;">
                <h3>⚠️ 생성 오류</h3>
                <p id="brdErrorText"></p>
                <button class="btn-primary" onclick="retryBRDGeneration()">다시 시도</button>
            </div>

            <!-- 생성된 문서 내용 -->
            <div id="brdContentWrapper" style="display: none;">
                <div class="document-content" id="brdContent"></div>
                
                <div class="document-actions">
                    <button class="btn-success" onclick="approveBRD()">✓ 승인하고 PRD 생성</button>
                    <button class="btn-outline" onclick="regenerateBRD()">↻ 다시 생성</button>
                    <button class="btn-outline" onclick="copyBRD()">📋 복사</button>
                    <button class="btn-outline" onclick="exportBRDtoPDF()">📄 PDF 내보내기</button>
                </div>
            </div>
        </div>

        <!-- PRD 생성 화면 -->
        <div class="form-card document-screen" id="prdScreen">
            <div class="document-header">
                <h2 class="document-title">Product Requirements Document</h2>
                <span class="document-badge badge-generating" id="prdBadge">생성 중</span>
            </div>

            <div class="generating-animation" id="prdGenerating">
                <div class="spinner"></div>
                <div class="generating-text">PRD를 생성하고 있습니다...</div>
                <div class="generating-subtext">BRD를 기반으로 상세 요구사항을 작성 중입니다</div>
            </div>

            <div class="error-message" id="prdError" style="display: none;">
                <h3>⚠️ 생성 오류</h3>
                <p id="prdErrorText"></p>
                <button class="btn-primary" onclick="retryPRDGeneration()">다시 시도</button>
            </div>

            <div id="prdContentWrapper" style="display: none;">
                <div class="document-content" id="prdContent"></div>
                
                <div class="document-actions">
                    <button class="btn-success" onclick="approvePRD()">✓ 승인하고 TRD 생성</button>
                    <button class="btn-outline" onclick="regeneratePRD()">↻ 다시 생성</button>
                    <button class="btn-outline" onclick="copyPRD()">📋 복사</button>
                    <button class="btn-outline" onclick="exportPRDtoPDF()">📄 PDF 내보내기</button>
                    <button class="btn-outline" onclick="skipToComplete()">건너뛰기</button>
                </div>
            </div>
        </div>

        <!-- TRD 생성 화면 -->
        <div class="form-card document-screen" id="trdScreen">
            <div class="document-header">
                <h2 class="document-title">Technical Requirements Document</h2>
                <span class="document-badge badge-generating" id="trdBadge">생성 중</span>
            </div>

            <div class="generating-animation" id="trdGenerating">
                <div class="spinner"></div>
                <div class="generating-text">TRD를 생성하고 있습니다...</div>
                <div class="generating-subtext">기술 스펙과 아키텍처를 설계 중입니다</div>
            </div>

            <div class="error-message" id="trdError" style="display: none;">
                <h3>⚠️ 생성 오류</h3>
                <p id="trdErrorText"></p>
                <button class="btn-primary" onclick="retryTRDGeneration()">다시 시도</button>
            </div>

            <div id="trdContentWrapper" style="display: none;">
                <div class="document-content" id="trdContent"></div>
                
                <div class="document-actions">
                    <button class="btn-success" onclick="completeProject()">✓ 프로젝트 완료</button>
                    <button class="btn-outline" onclick="regenerateTRD()">↻ 다시 생성</button>
                    <button class="btn-outline" onclick="copyTRD()">📋 복사</button>
                    <button class="btn-outline" onclick="exportTRDtoPDF()">📄 PDF 내보내기</button>
                </div>
            </div>
        </div>

        <!-- 최종 완료 화면 -->
        <div class="form-card completion-screen" id="finalCompletionScreen">
            <div class="completion-icon">🎉</div>
            <h2 class="completion-title">모든 문서 생성 완료!</h2>
            <p class="completion-desc">
                BRD, PRD, TRD가 성공적으로 생성되었습니다.<br>
                모든 문서를 다운로드하거나 새 프로젝트를 시작할 수 있습니다.
            </p>
            <div class="document-actions" style="justify-content: center;">
                <button class="btn-primary" onclick="downloadAllDocuments()">📦 모든 문서 다운로드</button>
                <button class="btn-outline" onclick="startNewProject()">🔄 새 프로젝트 시작</button>
            </div>
        </div>

        <div class="button-group" id="navigationButtons">
            <button class="btn-secondary" id="prevBtn" onclick="prevStep()" style="display: none;">이전</button>
            <button class="btn-primary" id="nextBtn" onclick="nextStep()" disabled>다음</button>
        </div>

        <div class="auto-save-indicator" id="autoSaveIndicator">
            💾 자동 저장됨
        </div>
    </div>

    <script>
        // UUID 생성 함수
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // 프로젝트 데이터 구조
        class ProjectData {
            constructor() {
                this.id = generateUUID();
                this.created_at = new Date().toISOString();
                this.updated_at = new Date().toISOString();
                this.status = 'input';
                
                this.user_input = {
                    insight: '',
                    evidence: '',
                    capability: '',
                    principle: '',
                    success_metric: '',
                    core_features: ''
                };
                
                this.documents = {
                    brd: {
                        content: '',
                        status: 'pending',
                        generated_at: null,
                        version: 0
                    },
                    prd: {
                        content: '',
                        status: 'pending',
                        generated_at: null,
                        version: 0
                    },
                    trd: {
                        content: '',
                        status: 'pending',
                        generated_at: null,
                        version: 0
                    }
                };
                
                this.structured_data = {
                    personas: [],
                    features: [],
                    metrics: [],
                    technical_specs: []
                };

                this.history = [];
            }

            // 데이터 업데이트
            updateUserInput(field, value) {
                this.user_input[field] = value;
                this.updated_at = new Date().toISOString();
                this.addHistory('user_input_updated', { field, value });
                this.save();
            }

            // 상태 변경
            updateStatus(newStatus) {
                const oldStatus = this.status;
                this.status = newStatus;
                this.updated_at = new Date().toISOString();
                this.addHistory('status_changed', { from: oldStatus, to: newStatus });
                this.save();
            }

            // 문서 생성 시작
            startDocumentGeneration(docType) {
                this.documents[docType].status = 'generating';
                this.updated_at = new Date().toISOString();
                this.addHistory('document_generation_started', { type: docType });
                this.save();
            }

            // 문서 생성 완료
            completeDocumentGeneration(docType, content) {
                this.documents[docType].content = content;
                this.documents[docType].status = 'generated';
                this.documents[docType].generated_at = new Date().toISOString();
                this.documents[docType].version++;
                this.updated_at = new Date().toISOString();
                this.addHistory('document_generated', { type: docType, version: this.documents[docType].version });
                this.save();
            }

            // 문서 승인
            approveDocument(docType) {
                this.documents[docType].status = 'approved';
                this.updated_at = new Date().toISOString();
                this.addHistory('document_approved', { type: docType });
                this.save();
            }

            // 구조화된 데이터 추가
            addStructuredData(category, data) {
                this.structured_data[category].push({
                    id: generateUUID(),
                    ...data,
                    created_at: new Date().toISOString()
                });
                this.updated_at = new Date().toISOString();
                this.addHistory('structured_data_added', { category, data });
                this.save();
            }

            // 히스토리 추가
            addHistory(action, details) {
                this.history.push({
                    timestamp: new Date().toISOString(),
                    action,
                    details
                });
            }

            // 로컬 스토리지에 저장
            save() {
                try {
                    localStorage.setItem('projectData', JSON.stringify(this));
                    localStorage.setItem('projectData_backup_' + Date.now(), JSON.stringify(this));
                    console.log('✅ 프로젝트 데이터 저장 완료:', this.id);
                    return true;
                } catch (e) {
                    console.error('❌ 저장 실패:', e);
                    return false;
                }
            }

            // 로컬 스토리지에서 불러오기
            static load() {
                try {
                    const saved = localStorage.getItem('projectData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        const project = new ProjectData();
                        Object.assign(project, data);
                        console.log('✅ 프로젝트 데이터 로드 완료:', project.id);
                        return project;
                    }
                } catch (e) {
                    console.error('❌ 로드 실패:', e);
                }
                return new ProjectData();
            }

            // 진행률 계산
            getProgress() {
                const fields = Object.values(this.user_input);
                const completed = fields.filter(v => v && v.trim().length > 0).length;
                return {
                    completed,
                    total: fields.length,
                    percentage: Math.round((completed / fields.length) * 100)
                };
            }

            // 입력 완료 여부 확인
            isInputComplete() {
                return Object.values(this.user_input).every(v => v && v.trim().length > 0);
            }

            // 데이터 내보내기 (JSON)
            exportJSON() {
                return JSON.stringify(this, null, 2);
            }

            // 데이터 요약
            getSummary() {
                const progress = this.getProgress();
                return {
                    id: this.id,
                    created: new Date(this.created_at).toLocaleString('ko-KR'),
                    updated: new Date(this.updated_at).toLocaleString('ko-KR'),
                    status: this.status,
                    progress: `${progress.completed}/${progress.total} (${progress.percentage}%)`,
                    documents: {
                        brd: this.documents.brd.status,
                        prd: this.documents.prd.status,
                        trd: this.documents.trd.status
                    }
                };
            }
        }

        // 전역 프로젝트 인스턴스
        let projectData = ProjectData.load();

        // 상태 관리
        let currentStep = 1;
        const totalSteps = 6;
        
        // 필드 매핑 (화면 ID -> 데이터 구조)
        const fieldMapping = {
            insight: 'insight',
            validation: 'evidence',
            capability: 'capability',
            principle: 'principle',
            success: 'success_metric',
            feature: 'core_features'
        };

        // 로컬 스토리지에서 데이터 불러오기
        function loadSavedData() {
            const saved = localStorage.getItem('productDocData');
            if (saved) {
                const data = JSON.parse(saved);
                Object.assign(formData, data);
                
                // 입력 필드에 저장된 데이터 채우기
                Object.keys(formData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element && formData[key]) {
                        element.value = formData[key];
                        updateCharCount(key);
                    }
                });
            }
        }

        // 자동 저장
        function autoSave() {
            localStorage.setItem('productDocData', JSON.stringify(formData));
            showAutoSaveIndicator();
        }

        function showAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // 글자수 카운터 업데이트
        function updateCharCount(fieldId) {
            const textarea = document.getElementById(fieldId);
            const counter = document.getElementById(fieldId + 'Count');
            const status = document.getElementById(fieldId + 'Status');
            const maxLength = textarea.maxLength;
            const currentLength = textarea.value.length;
            
            counter.textContent = `${currentLength} / ${maxLength}자`;
            
            if (currentLength > maxLength * 0.9) {
                counter.classList.add('warning');
            } else {
                counter.classList.remove('warning');
            }

            // 유효성 검사
            if (currentLength > 0) {
                status.textContent = '✓';
                status.style.color = '#a89075';
                textarea.classList.remove('error');
            } else {
                status.textContent = '';
                textarea.classList.add('error');
            }

            // 데이터 저장
            formData[fieldId] = textarea.value;
            autoSave();

            // 다음 버튼 활성화/비활성화
            updateNextButton();
        }

        // 다음 버튼 상태 업데이트
        function updateNextButton() {
            const nextBtn = document.getElementById('nextBtn');
            const currentField = getCurrentFieldId();
            const currentValue = formData[currentField];
            
            if (currentValue && currentValue.trim().length > 0) {
                nextBtn.disabled = false;
            } else {
                nextBtn.disabled = true;
            }
        }

        // 현재 필드 ID 가져오기
        function getCurrentFieldId() {
            const fields = ['insight', 'validation', 'capability', 'principle', 'success', 'feature'];
            return fields[currentStep - 1];
        }

        // 진행률 업데이트
        function updateProgress() {
            const progress = ((currentStep - 1) / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `질문 ${currentStep} / ${totalSteps}`;
            document.getElementById('progressPercent').textContent = `${Math.round(progress)}% 완료`;
        }

        // 다음 단계
        function nextStep() {
            if (currentStep < totalSteps) {
                // 현재 카드 숨기기
                document.querySelector(`.form-card[data-step="${currentStep}"]`).classList.remove('active');
                
                currentStep++;
                
                // 다음 카드 보이기
                document.querySelector(`.form-card[data-step="${currentStep}"]`).classList.add('active');
                
                updateProgress();
                updateNextButton();
                
                // 버튼 표시 조정
                document.getElementById('prevBtn').style.display = 'block';
                
                if (currentStep === totalSteps) {
                    document.getElementById('nextBtn').textContent = '완료';
                }
                
                // 스크롤 맨 위로
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showCompletion();
            }
        }

        // 이전 단계
        function prevStep() {
            if (currentStep > 1) {
                document.querySelector(`.form-card[data-step="${currentStep}"]`).classList.remove('active');
                
                currentStep--;
                
                document.querySelector(`.form-card[data-step="${currentStep}"]`).classList.add('active');
                
                updateProgress();
                updateNextButton();
                
                if (currentStep === 1) {
                    document.getElementById('prevBtn').style.display = 'none';
                }
                
                document.getElementById('nextBtn').textContent = '다음';
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // 완료 화면 표시
        function showCompletion() {
            document.querySelector(`.form-card[data-step="${currentStep}"]`).classList.remove('active');
            document.getElementById('completionScreen').classList.add('active');
            document.getElementById('navigationButtons').style.display = 'none';
            
            // 진행률 100%
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('progressText').textContent = '완료!';
            document.getElementById('progressPercent').textContent = '100% 완료';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 문서 생성 (다음 단계로 연결될 함수)
        function generateDocuments() {
            alert('Phase 2: BRD, PRD, TRD 문서 생성 기능이 곧 추가됩니다!\n\n입력된 데이터:\n' + JSON.stringify(formData, null, 2));
        }

        // 이벤트 리스너 설정
        document.addEventListener('DOMContentLoaded', function() {
            // 저장된 데이터 불러오기
            loadSavedData();
            
            // 각 textarea에 이벤트 리스너 추가
            const fields = ['insight', 'validation', 'capability', 'principle', 'success', 'feature'];
            fields.forEach(fieldId => {
                const textarea = document.getElementById(fieldId);
                textarea.addEventListener('input', () => updateCharCount(fieldId));
                textarea.addEventListener('blur', autoSave);
            });

            // 초기 진행률 업데이트
            updateProgress();
            updateNextButton();
        });

        // 키보드 단축키
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                if (!document.getElementById('nextBtn').disabled) {
                    nextStep();
                }
            }
        });
    </script>
</body>
</html>
